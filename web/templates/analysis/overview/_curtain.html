{% if analysis.curtain %}
<div class="card bg-dark border-secondary mb-3">
    <div class="card-header border-secondary" id="headingCurtain">
        <h5 class="mb-0">
            <button class="btn btn-link btn-block text-start text-white text-decoration-none collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#curtain" aria-expanded="false" aria-controls="curtain">
                <i class="fas fa-terminal me-2 text-warning"></i> Curtain
                <i class="fas fa-chevron-down float-end mt-1"></i>
            </button>
        </h5>
    </div>
    <div id="curtain" class="collapse" aria-labelledby="headingCurtain">
        <div class="card-body p-3">
            <ul class="nav nav-pills mb-3" id="curtainTabs" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="curtain-orig-tab" data-bs-toggle="pill" href="#curtain_orig_tab" role="tab" aria-controls="curtain_orig_tab" aria-selected="true">Original Events</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="curtain-altr-tab" data-bs-toggle="pill" href="#curtain_altr_tab" role="tab" aria-controls="curtain_altr_tab" aria-selected="false">Altered Events</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="curtain-filt-tab" data-bs-toggle="pill" href="#curtain_filt_tab" role="tab" aria-controls="curtain_filt_tab" aria-selected="false">Filtered Events</a>
                </li>
            </ul>
            <div class="tab-content" id="curtainTabContent">
                <!-- Original Events -->
                <div class="tab-pane fade show active" id="curtain_orig_tab" role="tabpanel" aria-labelledby="curtain-orig-tab">
                    {% if analysis.curtain %}
                        {% for pid,dict in analysis.curtain.items %}
                        <div class="card bg-dark mb-3">
                            <div class="card-header border-dark font-weight-bold">
                                PID: {{pid}}
                                {% for entry in dict.behaviors %}
                                <span class="badge text-white bg-dark ms-2">{{ entry }}</span>
                                {% endfor %}
                            </div>
                            <div class="card-body bg-dark text-white">
                                {% for entry in dict.events %}
                                    {% for event,message in entry.items %}
                                        <div class="mb-2">
                                            <strong class="text-info">Event: {{ event }}</strong>
                                            <p class="mb-0 small text-white-50">{{ message.original|linebreaksbr }}</p>
                                        </div>
                                    {% endfor %}
                                {% endfor %}
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <p class="text-white-50">No original events found.</p>
                    {% endif %}
                </div>

                <!-- Altered Events -->
                <div class="tab-pane fade" id="curtain_altr_tab" role="tabpanel" aria-labelledby="curtain-altr-tab">
                    {% if analysis.curtain %}
                        {% for pid,dict in analysis.curtain.items %}
                        <div class="card bg-dark mb-3">
                            <div class="card-header border-dark font-weight-bold">
                                PID: {{pid}}
                                {% for entry in dict.behaviors %}
                                <span class="badge text-white bg-dark ms-2">{{ entry }}</span>
                                {% endfor %}
                            </div>
                            <div class="card-body bg-dark text-white">
                                {% for entry in dict.events %}
                                    {% for event,message in entry.items %}
                                        <div class="mb-2">
                                            <strong class="text-warning">Event: {{ event }}</strong>
                                            <p class="mb-0 small text-white-50">{{ message.altered|linebreaksbr }}</p>
                                        </div>
                                    {% endfor %}
                                {% endfor %}
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <p class="text-white-50">No altered events found.</p>
                    {% endif %}
                </div>

                <!-- Filtered Events -->
                <div class="tab-pane fade" id="curtain_filt_tab" role="tabpanel" aria-labelledby="curtain-filt-tab">
                    {% if analysis.curtain %}
                        {% for pid,dict in analysis.curtain.items %}
                        <div class="card bg-dark mb-3">
                            <div class="card-header border-dark font-weight-bold">
                                PID: {{pid}}
                                {% for entry in dict.behaviors %}
                                <span class="badge text-white bg-dark ms-2">{{ entry }}</span>
                                {% endfor %}
                            </div>
                            <div class="card-body bg-dark text-white">
                                {% for entry in dict.filter %}
                                    {% for event,message in entry.items %}
                                        <div class="mb-2">
                                            <strong class="text-danger">Event: {{ event }}</strong>
                                            <p class="mb-0 small text-white-50">{{ message|linebreaksbr }}</p>
                                        </div>
                                    {% endfor %}
                                {% endfor %}
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <p class="text-white-50">No filtered events found.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}
