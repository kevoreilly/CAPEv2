{% if analysis.behavior.summary %}
<section id="summary" class="mb-4">
    <div class="card border-secondary">
        <div class="card-header border-secondary">
            <h5 class="mb-0 text-white"><i class="fas fa-list-alt me-2 text-primary"></i> Summary</h5>
        </div>
        <div class="card-body">
            <div class="row">

                <!-- Left column - Accordion navigation (all collapsed) -->
                <div class="col-md-3 mb-3">
                    <div class="accordion" id="summaryAccordion">

                        {% if analysis.behavior.summary.files %}
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button"
                                        data-bs-toggle="collapse" data-bs-target="#summary_files"
                                        aria-expanded="false" aria-controls="summary_files">
                                    <i class="fas fa-file me-2"></i> Accessed Files
                                </button>
                            </h2>
                        </div>
                        {% endif %}

                        {% if analysis.behavior.summary.read_files %}
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button"
                                        data-bs-toggle="collapse" data-bs-target="#summary_read_files"
                                        aria-expanded="false" aria-controls="summary_read_files">
                                    <i class="fas fa-file-alt me-2"></i> Read Files
                                </button>
                            </h2>
                        </div>
                        {% endif %}

                        {% if analysis.behavior.summary.write_files %}
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button"
                                        data-bs-toggle="collapse" data-bs-target="#summary_write_files"
                                        aria-expanded="false" aria-controls="summary_write_files">
                                    <i class="fas fa-file-signature me-2"></i> Modified Files
                                </button>
                            </h2>
                        </div>
                        {% endif %}

                        {% if analysis.behavior.summary.delete_files %}
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button"
                                        data-bs-toggle="collapse" data-bs-target="#summary_delete_files"
                                        aria-expanded="false" aria-controls="summary_delete_files">
                                    <i class="fas fa-trash-alt me-2"></i> Deleted Files
                                </button>
                            </h2>
                        </div>
                        {% endif %}

                        {% if analysis.behavior.summary.keys %}
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button"
                                        data-bs-toggle="collapse" data-bs-target="#summary_keys"
                                        aria-expanded="false" aria-controls="summary_keys">
                                    <i class="fas fa-key me-2"></i> Registry Keys
                                </button>
                            </h2>
                        </div>
                        {% endif %}

                        {% if analysis.behavior.summary.read_keys %}
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button"
                                        data-bs-toggle="collapse" data-bs-target="#summary_read_keys"
                                        aria-expanded="false" aria-controls="summary_read_keys">
                                    <i class="fas fa-eye me-2"></i> Read Registry Keys
                                </button>
                            </h2>
                        </div>
                        {% endif %}

                        {% if analysis.behavior.summary.write_keys %}
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button"
                                        data-bs-toggle="collapse" data-bs-target="#summary_write_keys"
                                        aria-expanded="false" aria-controls="summary_write_keys">
                                    <i class="fas fa-edit me-2"></i> Modified Registry Keys
                                </button>
                            </h2>
                        </div>
                        {% endif %}

                        {% if analysis.behavior.summary.delete_keys %}
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button"
                                        data-bs-toggle="collapse" data-bs-target="#summary_delete_keys"
                                        aria-expanded="false" aria-controls="summary_delete_keys">
                                    <i class="fas fa-eraser me-2"></i> Deleted Registry Keys
                                </button>
                            </h2>
                        </div>
                        {% endif %}

                        {% if analysis.behavior.summary.resolved_apis %}
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button"
                                        data-bs-toggle="collapse" data-bs-target="#summary_resolved_apis"
                                        aria-expanded="false" aria-controls="summary_resolved_apis">
                                    <i class="fas fa-cogs me-2"></i> Resolved APIs
                                </button>
                            </h2>
                        </div>
                        {% endif %}

                        {% if analysis.behavior.summary.executed_commands %}
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button"
                                        data-bs-toggle="collapse" data-bs-target="#summary_executed_commands"
                                        aria-expanded="false" aria-controls="summary_executed_commands">
                                    <i class="fas fa-terminal me-2"></i> Executed Commands
                                </button>
                            </h2>
                        </div>
                        {% endif %}

                        {% if analysis.behavior.summary.mutexes %}
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button"
                                        data-bs-toggle="collapse" data-bs-target="#summary_mutexes"
                                        aria-expanded="false" aria-controls="summary_mutexes">
                                    <i class="fas fa-lock me-2"></i> Mutexes
                                </button>
                            </h2>
                        </div>
                        {% endif %}

                        {% if analysis.behavior.summary.created_services %}
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button"
                                        data-bs-toggle="collapse" data-bs-target="#summary_created_services"
                                        aria-expanded="false" aria-controls="summary_created_services">
                                    <i class="fas fa-plus-square me-2"></i> Created Services
                                </button>
                            </h2>
                        </div>
                        {% endif %}

                        {% if analysis.behavior.summary.started_services %}
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button"
                                        data-bs-toggle="collapse" data-bs-target="#summary_started_services"
                                        aria-expanded="false" aria-controls="summary_started_services">
                                    <i class="fas fa-play-circle me-2"></i> Started Services
                                </button>
                            </h2>
                        </div>
                        {% endif %}

                        {% if analysis.behavior.summary.reversing_labs %}
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button"
                                        data-bs-toggle="collapse" data-bs-target="#summary_reversing_labs"
                                        aria-expanded="false" aria-controls="summary_reversing_labs">
                                    <i class="fas fa-flask me-2"></i> Reversing Labs
                                </button>
                            </h2>
                        </div>
                        {% endif %}

                    </div>
                </div>

                <!-- Right column - Content (all collapsed initially) -->
                <div class="col-md-9">

                    {% if analysis.behavior.summary.files %}
                    <div id="summary_files" class="accordion-collapse collapse" data-bs-parent="#summaryAccordion">
                        <div class="accordion-body p-0">
                            <div class="card card-body border-secondary text-white" style="max-height: 500px; overflow-y: auto;">
                                <ul class="list-unstyled mb-0">
                                    {% for file in analysis.behavior.summary.files %}
                                        <li>{{file}}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    {% if analysis.behavior.summary.read_files %}
                    <div id="summary_read_files" class="accordion-collapse collapse" data-bs-parent="#summaryAccordion">
                        <div class="accordion-body p-0">
                            <div class="card card-body border-secondary text-white" style="max-height: 500px; overflow-y: auto;">
                                <ul class="list-unstyled mb-0">
                                    {% for file in analysis.behavior.summary.read_files %}
                                        <li>{{file}}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    {% if analysis.behavior.summary.write_files %}
                    <div id="summary_write_files" class="accordion-collapse collapse" data-bs-parent="#summaryAccordion">
                        <div class="accordion-body p-0">
                            <div class="card card-body border-secondary text-white" style="max-height: 500px; overflow-y: auto;">
                                <ul class="list-unstyled mb-0">
                                    {% for file in analysis.behavior.summary.write_files %}
                                        <li>{{file}}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    {% if analysis.behavior.summary.delete_files %}
                    <div id="summary_delete_files" class="accordion-collapse collapse" data-bs-parent="#summaryAccordion">
                        <div class="accordion-body p-0">
                            <div class="card card-body border-secondary text-white" style="max-height: 500px; overflow-y: auto;">
                                <ul class="list-unstyled mb-0">
                                    {% for file in analysis.behavior.summary.delete_files %}
                                        <li>{{file}}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    {% if analysis.behavior.summary.keys %}
                    <div id="summary_keys" class="accordion-collapse collapse" data-bs-parent="#summaryAccordion">
                        <div class="accordion-body p-0">
                            <div class="card card-body border-secondary text-white" style="max-height: 500px; overflow-y: auto;">
                                <ul class="list-unstyled mb-0">
                                    {% for key in analysis.behavior.summary.keys %}
                                        <li class="text-break">{{key}}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    {% if analysis.behavior.summary.read_keys %}
                    <div id="summary_read_keys" class="accordion-collapse collapse" data-bs-parent="#summaryAccordion">
                        <div class="accordion-body p-0">
                            <div class="card card-body border-secondary text-white" style="max-height: 500px; overflow-y: auto;">
                                <ul class="list-unstyled mb-0">
                                    {% for key in analysis.behavior.summary.read_keys %}
                                        <li class="text-break">{{key}}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    {% if analysis.behavior.summary.write_keys %}
                    <div id="summary_write_keys" class="accordion-collapse collapse" data-bs-parent="#summaryAccordion">
                        <div class="accordion-body p-0">
                            <div class="card card-body border-secondary text-white" style="max-height: 500px; overflow-y: auto;">
                                <ul class="list-unstyled mb-0">
                                    {% for key in analysis.behavior.summary.write_keys %}
                                        <li class="text-break">{{key}}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    {% if analysis.behavior.summary.delete_keys %}
                    <div id="summary_delete_keys" class="accordion-collapse collapse" data-bs-parent="#summaryAccordion">
                        <div class="accordion-body p-0">
                            <div class="card card-body border-secondary text-white" style="max-height: 500px; overflow-y: auto;">
                                <ul class="list-unstyled mb-0">
                                    {% for key in analysis.behavior.summary.delete_keys %}
                                        <li class="text-break">{{key}}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    {% if analysis.behavior.summary.resolved_apis %}
                    <div id="summary_resolved_apis" class="accordion-collapse collapse" data-bs-parent="#summaryAccordion">
                        <div class="accordion-body p-0">
                            <div class="card card-body border-secondary text-white" style="max-height: 500px; overflow-y: auto;">
                                <ul class="list-unstyled mb-0">
                                    {% for api in analysis.behavior.summary.resolved_apis %}
                                        <li>{{api}}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    {% if analysis.behavior.summary.executed_commands %}
                    <div id="summary_executed_commands" class="accordion-collapse collapse" data-bs-parent="#summaryAccordion">
                        <div class="accordion-body p-0">
                            <div class="card card-body border-secondary text-white" style="max-height: 500px; overflow-y: auto;">
                                <ul class="list-unstyled mb-0">
                                    {% for cmd in analysis.behavior.summary.executed_commands %}
                                        <li>{{cmd}}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    {% if analysis.behavior.summary.mutexes %}
                    <div id="summary_mutexes" class="accordion-collapse collapse" data-bs-parent="#summaryAccordion">
                        <div class="accordion-body p-0">
                            <div class="card card-body border-secondary text-white" style="max-height: 500px; overflow-y: auto;">
                                <ul class="list-unstyled mb-0">
                                    {% for mutex in analysis.behavior.summary.mutexes %}
                                        <li>{{mutex}}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    {% if analysis.behavior.summary.created_services %}
                    <div id="summary_created_services" class="accordion-collapse collapse" data-bs-parent="#summaryAccordion">
                        <div class="accordion-body p-0">
                            <div class="card card-body border-secondary text-white" style="max-height: 500px; overflow-y: auto;">
                                <ul class="list-unstyled mb-0">
                                    {% for service in analysis.behavior.summary.created_services %}
                                        <li>{{service}}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    {% if analysis.behavior.summary.started_services %}
                    <div id="summary_started_services" class="accordion-collapse collapse" data-bs-parent="#summaryAccordion">
                        <div class="accordion-body p-0">
                            <div class="card card-body border-secondary text-white" style="max-height: 500px; overflow-y: auto;">
                                <ul class="list-unstyled mb-0">
                                    {% for service in analysis.behavior.summary.started_services %}
                                        <li>{{service}}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    {% if analysis.behavior.summary.reversing_labs %}
                    <div id="summary_reversing_labs" class="accordion-collapse collapse" data-bs-parent="#summaryAccordion">
                        <div class="accordion-body">
                            <div class="card card-body border-secondary text-white">
                                {% if analysis.reversinglabs %}
                                <div class="table-responsive">
                                    <table class="table table-dark table-sm table-striped mb-0">
                                        <thead>
                                            <tr>
                                                <th>Name</th>
                                                <th>Value</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for key, value in analysis.reversinglabs.items %}
                                            <tr>
                                                <td>{{key|capfirst}}</td>
                                                {% if key == "permalink" %}
                                                    <td><a target="_blank" href="{{value}}" class="text-info">{{value}}</a></td>
                                                {% elif key == "malicious" and value%}
                                                    <td><span class="badge bg-danger">yes</span></td>
                                                {% elif key == "malicious" and not value%}
                                                    <td><span class="badge bg-success">no</span></td>
                                                {% else %}
                                                    <td>{{value}}</td>
                                                {% endif %}
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                {% else %}
                                    <p class="text-white-50">No results found.</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endif %}

                </div>
            </div>
        </div>
    </div>
</section>
{% endif %}